require 'pusher'
require 'sinatra'

get '/' do
  erb :index
end

post '/send' do
  pusher_client = Pusher::Client.new(
    app_id: '1997',
    key: '40cb94a171a79bd5b5ae',
    secret: '29410bfcc6e5d91d2213',
    host: 'api.staging.pusher.com',
    encrypted: true,
    notification_host: 'hedwig-staging.herokuapp.com'
  )

  pusher_client.notify(["yolo"], {
    webhook_url: "https://pusher.ngrok.io/webhooks",
    webhook_level: "DEBUG",
    apns: {
      aps: {
        alert: {
          body: params["message"]
        }
      }
    },
    gcm: {
      notification: {
        title: "Pusher",
        icon: "xxx",
        body: params["message"]
      }
    }
  })

  erb :index
end

post '/webhooks' do
  puts request.body.read
end